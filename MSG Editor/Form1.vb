Imports System
Imports System.IO


Public Class Form1

    Public kordic = "가각간갇갈갉갊감갑값갓갔강갖갗같갚갛개객갠갤갬갭갯갰갱갸갹갼걀걋걍걔걘걜거걱건걷걸걺검겁것겄겅겆겉겊겋게겐겔겜겝겟겠겡겨격겪견겯결겸겹겻겼경곁계곈곌곕곗고곡곤곧골곪곬곯곰곱곳공곶과곽관괄괆괌괍괏광괘괜괠괩괬괭괴괵괸괼굄굅굇굉교굔굘굡굣구국군굳굴굵굶굻굼굽굿궁궂궈궉권궐궜궝궤궷귀귁귄귈귐귑귓규균귤그극근귿글긁금급긋긍긔기긱긴긷길긺김깁깃깅깆깊까깍깎깐깔깖깜깝깟깠깡깥깨깩깬깰깸깹깻깼깽꺄꺅꺌꺼꺽꺾껀껄껌껍껏껐껑께껙껜껨껫껭껴껸껼꼇꼈꼍꼐꼬꼭꼰꼲꼴꼼꼽꼿꽁꽂꽃꽈꽉꽐꽜꽝꽤꽥꽹꾀꾄꾈꾐꾑꾕꾜꾸꾹꾼꿀꿇꿈꿉꿋꿍꿎꿔꿜꿨꿩꿰꿱꿴꿸뀀뀁뀄뀌뀐뀔뀜뀝뀨끄끅끈끊끌끎끓끔끕끗끙끝끼끽낀낄낌낍낏낑나낙낚난낟날낡낢남납낫났낭낮낯낱낳내낵낸낼냄냅냇냈냉냐냑냔냘냠냥너넉넋넌널넒넓넘넙넛넜넝넣네넥넨넬넴넵넷넸넹녀녁년녈념녑녔녕녘녜녠노녹논놀놂놈놉놋농높놓놔놘놜놨뇌뇐뇔뇜뇝뇟뇨뇩뇬뇰뇹뇻뇽누눅눈눋눌눔눕눗눙눠눴눼뉘뉜뉠뉨뉩뉴뉵뉼늄늅늉느늑는늘늙늚늠늡늣능늦늪늬늰늴니닉닌닐닒님닙닛닝닢다닥닦단닫달닭닮닯닳담답닷닸당닺닻닿대댁댄댈댐댑댓댔댕댜더덕덖던덛덜덞덟덤덥덧덩덪덫덮데덱덴델뎀뎁뎃뎄뎅뎌뎐뎔뎠뎡뎨뎬도독돈돋돌돎돐돔돕돗동돛돝돠돤돨돼됐되된될됨됩됫됴두둑둔둘둠둡둣둥둬뒀뒈뒝뒤뒨뒬뒵뒷뒹듀듄듈듐듕드득든듣들듦듬듭듯등듸디딕딘딛딜딤딥딧딨딩딪따딱딴딸텭땀땁땃땄땅땋때땍땐땔땜땝땟땠땡떠떡떤떨떪떫떰떱떳떴떵떻떼떽뗀뗄뗌뗍뗏뗐뗑뗘뗬또똑똔똘똥똬똴뙈뙤뙨뚜뚝뚠뚤뚫뚬뚱뛔뛰뛴뛸뜀뜁뜅뜨뜩뜬뜯뜰뜸뜹뜻띄띈띌띔띕띠띤띨띰띱띳띵라락란랄람랍랏랐랑랒랖랗퇏래랙랜랠램랩랫랬랭랴략랸럇량러럭런럴럼럽럿렀렁렇레렉렌렐렘렙렛렝려력련렬렴렵렷렸령례롄롑롓로록론롤롬롭롯롱롸롼뢍뢨뢰뢴뢸룀룁룃룅료룐룔룝룟룡루룩룬룰룸룹룻룽뤄뤘뤠뤼뤽륀륄륌륏륑류륙륜률륨륩툩륫륭르륵른를름릅릇릉릊릍릎리릭린릴림립릿링마막만많맏말맑맒맘맙맛망맞맡맣매맥맨맬맴맵맷맸맹맺먀먁먈먕머먹먼멀멂멈멉멋멍멎멓메멕멘멜멤멥멧멨멩며멱면멸몃몄명몇몌모목몫몬몰몲몸몹못몽뫄뫈뫘뫙뫼묀묄묍묏묑묘묜묠묩묫무묵묶문묻물묽묾뭄뭅뭇뭉뭍뭏뭐뭔뭘뭡뭣뭬뮈뮌뮐뮤뮨뮬뮴뮷므믄믈믐믓미믹민믿밀밂밈밉밋밌밍및밑바박밖밗반받발밝밞밟밤밥밧방밭배백밴밸뱀뱁뱃뱄뱅뱉뱌뱍뱐뱝버벅번벋벌벎범법벗벙벚베벡벤벧벨벰벱벳벴벵벼벽변별볍볏볐병볕볘볜보복볶본볼봄봅봇봉봐봔봤봬뵀뵈뵉뵌뵐뵘뵙뵤뵨부북분붇불붉붊붐붑붓붕붙붚붜붤붰붸뷔뷕뷘뷜뷩뷰뷴뷸븀븃븅브븍븐블븜븝븟비빅빈빌빎빔빕빗빙빚빛빠빡빤빨빪빰빱빳빴빵빻빼빽뺀뺄뺌뺍뺏뺐뺑뺘뺙뺨뻐뻑뻔뻗뻘뻠뻣뻤뻥뻬뼁뼈뼉뼘뼙뼛뼜뼝뽀뽁뽄뽈뽐뽑뽕뾔뾰뿅뿌뿍뿐뿔뿜뿟뿡쀼쁑쁘쁜쁠쁨쁩삐삑삔삘삠삡삣삥사삭삯산삳살삵삶삼삽삿샀상샅새색샌샐샘샙샛샜생샤샥샨샬샴샵샷샹섀섄섈섐섕서석섞섟선섣설섦섧섬섭섯섰성섶세섹센셀셈셉셋셌셍셔셕션셜셤셥셧셨셩셰셴셸솅소속솎손솔솖솜솝솟송솥솨솩솬솰솽쇄쇈쇌쇔쇗쇘쇠쇤쇨쇰쇱쇳쇼쇽숀숄숌숍숏숑수숙순숟술숨숩숫숭숯숱숲숴쉈쉐쉑쉔쉘쉠쉥쉬쉭쉰쉴쉼쉽쉿슁슈슉슐슘슛슝스슥슨슬슭슴습슷승시식신싣실싫심십싯싱싶싸싹싻싼쌀쌈쌉쌌쌍쌓쌔쌕쌘쌜쌤쌥쌨쌩썅써썩썬썰썲썸썹썼썽쎄쎈쎌쏀쏘쏙쏜쏟쏠쏢쏨쏩쏭쏴쏵쏸쐈쐐쐤쐬쐰쐴쐼쐽쑈쑤쑥쑨쑬쑴쑵쑹쒀쒔쒜쒸쒼쓩쓰쓱쓴쓸쓺쓿씀씁씌씐씔씜씨씩씬씰씸씹씻씽아악안앉않알앍앎앓암압앗았앙앝앞애액앤앨앰앱앳앴앵야약얀얄얇얌얍얏양얕얗얘얜얠얩어억언얹얻얼얽얾엄업없엇었엉엊엌엎에엑엔엘엠엡엣엥여역엮연열엶엷염엽엾엿였영옅옆옇예옌옐옘옙옛옜오옥온올옭옮옰옳옴옵옷옹옻와왁완왈왐왑왓왔왕왜왝왠왬왯왱외왹왼욀욈욉욋욍요욕욘욜욤욥욧용우욱운울욹욺움웁웃웅워웍원월웜웝웠웡웨웩웬웰웸웹웽위윅윈윌윔윕윗윙유육윤율윰윱윳융윷으윽은을읊음읍읏응읒읓읔읕읖읗의읜읠읨읫이익인일읽읾잃임입잇있잉잊잎자작잔잖잗잘잚잠잡잣잤장잦재잭잰잴잼잽잿쟀쟁쟈쟉쟌쟎쟐쟘쟝쟤쟨쟬저적전절젊점접젓정젖제젝젠젤젬젭젯젱져젼졀졈졉졌졍졔조족존졸졺좀좁좃종좆좇좋좌좍좔좝좟좡좨좼좽죄죈죌죔죕죗죙죠죡죤죵주죽준줄줅줆줌줍줏중줘줬줴쥐쥑쥔쥘쥠쥡쥣쥬쥰쥴쥼즈즉즌즐즘즙즛증지직진짇질짊짐집짓징짖짙짚짜짝짠짢짤짧짬짭짯짰짱째짹짼쨀쨈쨉쨋쨌쨍쨔쨘쨩쩌쩍쩐쩔쩜쩝쩟쩠쩡쩨쩽쪄쪘쪼쪽쫀쫄쫌쫍쫏쫑쫓쫘쫙쫠쫬쫴쬈쬐쬔쬘쬠쬡쭁쭈쭉쭌쭐쭘쭙쭝쭤쭸쭹쮜쮸쯔쯤쯧쯩찌찍찐찔찜찝찡찢찧차착찬찮찰참찹찻찼창찾채책챈챌챔챕챗챘챙챠챤챦챨챰챵처척천철첨첩첫첬청체첵첸첼쳄쳅쳇쳉쳐쳔쳤쳬쳰촁초촉촌촐촘촙촛총촤촨촬촹최쵠쵤쵬쵭쵯쵱쵸춈추축춘출춤춥춧충춰췄췌췐취췬췰췸췹췻췽츄츈츌츔츙츠측츤츨츰츱츳층치칙친칟칠칡침칩칫칭카칵칸칼캄캅캇캉캐캑캔캘캠캡캣캤캥캬캭컁커컥컨컫컬컴컵컷컸컹케켁켄켈켐켑켓켕켜켠켤켬켭켯켰켱켸코콕콘콜콤콥콧콩콰콱콴콸쾀쾅쾌쾡쾨쾰쿄쿠쿡쿤쿨쿰쿱쿳쿵쿼퀀퀄퀑퀘퀭퀴퀵퀸퀼큄큅큇큉큐큔큘큠크큭큰클큼큽킁키킥킨킬킴킵킷킹타탁탄탈탉탐탑탓탔탕태택탠탤탬탭탯탰탱탸턍터턱턴털턺텀텁텃텄텅테텍텐텔템텝텟텡텨텬텼톄톈토톡톤톨톰톱톳통톺톼퇀퇘퇴퇸툇툉툐투툭툰툴툼툽툿퉁퉈퉜퉤튀튁튄튈튐튑튕튜튠튤튬튱트특튼튿틀틂틈틉틋틔틘틜틤틥티틱틴틸팀팁팃팅파팍팎판팔팖팜팝팟팠팡팥패팩팬팰팸팹팻팼팽퍄퍅퍼퍽펀펄펌펍펏펐펑페펙펜펠펨펩펫펭펴편펼폄폅폈평폐폘폡폣포폭폰폴폼폽폿퐁퐈퐝푀푄표푠푤푭푯푸푹푼푿풀풂품풉풋풍풔풩퓌퓐퓔퓜퓟퓨퓬퓰퓸퓻퓽프픈플픔픕픗피픽핀필핌핍핏핑하학한할핥함합핫항해핵핸핼햄햅햇했행햐향허헉헌헐헒험헙헛헝헤헥헨헬헴헵헷헹혀혁현혈혐협혓혔형혜혠혤혭호혹혼홀홅홈홉홋홍홑화확환활홧황홰홱홴횃횅회획횐횔횝횟횡효횬횰횹횻후훅훈훌훑훔훗훙훠훤훨훰훵훼훽휀휄휑휘휙휜휠휨휩휫휭휴휵휸휼흄흅흉흐흑흔흖흗흘흙흠흡흣흥흩희흰흴흼흽힁히힉힌힘힐힙힛"
    Public Jisdic = "家各姦Γ葛駅丑感甲ΔΕΘ姜ΛΨγηξ開客ψБЁЖЙЦ粳Ю醵榎奄鴛⊥凹旺欧居∟建⊿傑襖檢怯∪л鴬旭飴粟闇偈荻億牡卸伽萎佳茨格珂犬禾結兼稼苛蝦經磯界蚊俄芽蛾高谷困拐骨械灰芥蟹劾崖工侃科郭官括碍浬馨垣光掛蛎鈎劃嚇核傀掴赫顎鰍潟恰宏撹渇滑褐鎌九國君厩屈噛ё鴨栢郁茅宮萱粥憾權闕澗潅机缶貴莞閑舘巌翫伎圭均橘棋極根汽軌飢今岌犠兢祇基蟻緊掬吉吃桔砧杵黍汲灸亨僑兇娃薗峡蕎尭桐禽芹菌衿襟吟区狗玖躯駈駒寓串釧屑沓靴窪謂隈粂栗Г薫袈啓径慧憩畦罫頚鯨拳軒鹸諺糊袴股菰鈷檎瑚醐鯉喉坑垢庚拘稿糠肯肱腔郊鉱砿閤劫濠甑坤墾梱痕紺唆嵯瑳裟坐挫栽犀阪堺榊肴埼碕咋搾鮭笹擦皐鯖捌鮫皿晒撒燦珊蚕酸餐仔屍枝祉Д誌爾痔汐軸宍那諾悉暖偲捺蕊斜南納紗杓娘灼惹趣愁耐拾洲臭蒐酋什夙冷竣准旬楯曙渚薯藷鋤娼宵抄梢樵沼硝粧菖蕉裳訟醤鉦鞘剰壌嬢擾女蒸年醸念錠嘱寧埴禰拭努穐蝕伸榛疹紳薪農塵腎В訊靭諏悩睡粋椙菅摺嫋畝醒脆脊蹟摂耨煎嫩煽吶穿羨腺舛詮賎践銑閃漸膳糎紐衄噌岨措曽疏租遡叢匝惣掻槽漕能痩糟鎗霜臓尼溺捉昵俗其葵揃詑唾多蔭妥團楕達騨胎腿苔淡答鯛醍當鷹瀧啄大宅濁茸蛸但竪坦箪綻蛋徳弛畜窒宙註酎渥樗苧凋芦喋帖暢牒腸蝶諜捗椎塚栂漬鍔坪嬬紬爪鶴道獨敦汀突禎訂蹄滴笛洞鏑哲轍迭纏甜貼顛澱菟砥凍套搭兜淫屯棟痘糖謄豆鐙憧撞萄瞳峠鴇匿涜栃凸鳶苫寅酉瀞得奈乍凪灘馴楠弐等匂賑廿尿韮祢猫捻撚乃埜膿覗蚤播杷琶婆芭俳排肺培楳狽賠這蝿萩粕舶曝漠莫駁函箱硲箸櫨畠鉢溌筏鳩噺塙蛤汎販釆頒匪緋誹枇琵柊稗疋髭肘畢桧謬瓢票秒鋲蒜蛭鰭斌瀕瓶埠冨鯵芙葡葺蕗吋弗鮒噴墳扮紛雰丙蔽頁僻碧瞥箆遍娩螺落乱剌覽拉戊虻浪菩倣峯庖來泡烹縫胞蓬剖坊帽鵜略某肪量膨貿鉾頬撲釦殆昧哩槙膜柾鱒亦俣繭麿箕砺力恋烈廉獵湊蓑澪禮稔鵡椋鷺綠論牝棉麺摸籠妄儲杢餅瀬尤紋匁爺愉佑料悠揖柚湧龍累涌猷郵傭曜溶熔窯蓉沃淀莱酪欄濫梨璃流六倫律痢葎掠琉隆寮勒瞭稜凛諒姐陵厘淋燐理瑠隣塁臨立嶺怜馬幕萬苓憐末漣簾聯廊榔望篭聾蝋賣脈歪枠亙亘鰐詫盟蕨椀碗亢丐个丱丶丼丿乖乘亅亳亶从仍仄仞价估佛佝佇佶侏覓面滅侘佻明侑袂模木佯侖沒儘俔俟俎夢俘俛俚俐俤俥倔倪倥倅苗伜倡倩倬武墨俾文俯物們倆假偕偖偬傚傴僊傳僂僖僞僥僮價僵儖儕儔儚儡儺儷儻儿兒美兌民兔密竸兮冂囘冏冑冓冕冖朴冤冦反冢發冩絢冪冫决冱方冲配白冰况姥冽凅凉几欝凩凭凾刋刎刧繁刪罰刮範法刳刹剪剴剳剿剽劔劒剱劈劑辨辧壁變別劬劭劼炳劵勁勍保福勞本勦飭勵勸奉勹匆匍匐匏渦匕匚唄匯匱匳匸部北分區不卆卅丗卍凖棚卩卮夘卻厂厖厠厦厥厮厰厶叟叮叨叭叺吁吽呀听吼吝呎悲咏貧咎呟呱呷呰氷咒臼呻咀哇咢咥咬哄哈Е哂咾咼哘哦唏唔哽閏哮哭哺哢唹啀啣啌售啜啅啗唸唳啝喙鰻喀咯喊喟啻啾喞啼喩喇嗚嗅嗟嗜嗤嗔嘔嗷嘖嗾嗽嘛嗹噎嘶嘸噫嘯嚆嚀嚊嚠嚔嚏嚥囂嚼囁社朔囃傘囀殺囈按三渋囓囗上圀塞色囿圄圉圈圓圖生嗇圦圷坎圻址坏坩垈坿垉垠垳西石垤垪善垰設埃埒繊燮埖埣成堋世塲堡塰塒堽墅墹墫壞墸墮壅壑壗壙壘壥壜壤壯壻所速壼孫蟀壽夂夊夐宋夛梦夥夬夭夲刷奚奘奧奬奩衰奸妁妝侫妣妲姨妍姙娥娟娑娉水淑順娚術婀婬婉崇娵婢婪媼嫂嫗嫖嫺嫻嬋嬖淬嬲嫐荏嬪嬶嬾孃孀孑孕孛孩孰孳斈孺蝨它宸湿寃勝匙植新寉實寐心十寢寞寥寫寳尅尓尢尨屁屆雙屓孱屬屮乢屶岔岫岻岶岼岷峅峇峭嶌崋崕崗嵜崟崛崑崢崚崙崘嵎嵬嵳嵶嶇嶄嶢嶝嶬嶮嶽嶐嶼巉巍巓巒巛帚帙幃幀幎幗幔幟幢幇麼广庠廁廂廈廐廏廣廝廚廛廡廩氏廱廳廰廴廸廾弉亞惡安彝彜斡弑弖弭巖壓弸彁央彈彎愛額弯彑彗彡彳彷桜野鰯液徃徂彿洩徊襄很徑徇從徙徘漁憶言徠徨蘖忻忤嚴業忸忱忝悳忿怡恠恚怙円怐怩怱怛怫餘易怦然熱怏恁炎燁恍恃恂英頴恫恙叡悁悍悃悚悄悖五玉穩兀悗悧悋悸惓悴忰擁悽瓦惆完曰悵慍愆惶王倭惷鞍愀惴惺外愃愡惻愾愨愧慊要慾愼愬愴愽慂用宇勗云鬱慳慷慘慙蔚雄慚慫原月慴慯慥慱慝慓慵憙憖憇憊位憑憮懊懈懃憺懋有育尹聿罹懍懣融懶懺懴隠乙懾音邑戉應戍戌戔戛戞戡毅戮戳扁扞二益人日扣扛扠任入扨扼剩找抒自作殘抓抖拔抃暫雜抔拗奨抻在拏拿拆擔拈拜拌爭拊拂拇抛挌拮拱挧挂拯著的全節拵店接捐政捍済搜捏掎掀捶掣掏掉掟掵捫捩揀揆揣操族存卒搆搦搶搏種摧摶攪左撕撓撥撩撈據擅擇罪撻擘擂舉擡抬擯攬擴擺主竹俊茁攤攫攴攷收中畋敕敍敘敝敲斂斃斛斫斷旃旆旁旒即旙櫛怎汁无證地織唇旡質旱斟輯杲澄昊昃昴昜晄晁晞晤晨晟晢晰暃暄暘暾暼暸曖曚昿曦曩曵曷朏朖朦朿杁朸朷杆杞杠杙杣杤杰枌枋枦枡枅枷柬枳柩枸柤柞柝柢柮柆柧栞框桍栲桎梳桙档桷桿梏梭梔梛梃檮梹梵桾椁棊椢棡椌棍棔棧棕椄且着贊棗察參椥棹棠昌棯債策椨椪椚椣椡棆楹楜楫楾楮椹楴處拓川鐵添捷椽椰晴体楡楞榁楪榲榮槐槁槓榾槝榻樮楚囑村榠榕榴槨總槿槲撮槧崔樞槭樔槫樒櫁樣樓追築春出橄橲樶忠橸橦萃樢取檐檍檣檗蘗檻櫃櫂檸檳櫟櫚側齔櫪欅櫺欒層治則親欖七欟侵蟄欸稱欷盜欹歃歉歐歙歔歛歟歡歹歿殄殃殍殕殞殤殪殫殯殱殳殼毆毟毬毫毳毯麾氓气氛氤汞汕汢汪沂沍沚汾沽泗泝沱沺泯泙泪洟洸洙洵洳洒洌浣涓快浤浙涎涕淹渕淇淦涸淆淌淒淅淺淙淕淪湮渮湲湟渣湫渫湶湍渟湃渺湎溂渝溘滉溷滓溯滄溲滔溏滂滾滲漱他託炭奪滯探塔漲滌宕太澤潺潸澁澀潛濳潭澂澎澳澣澡濆濕濔濘濛瀋濺瀑瀁瀏濾瀛瀚潴瀘瀟瀰瀲炒炯土烱噸炬炸炮烟通烋烝焙熈退煢煖熕熨投熹熾燉燔燎燵燼燹燿爛爨爰爻爼爿牀牋牘牴牾犁犇犒特緯犧犲狆闖狎狒狢倏猊猴猯猩猥獏獗獻獺珈玳波珎玻判八珀珥珮璢琥珸琲敗琺瑕琿瑟璞瓏瓔彭珱愎瓠瓣瓧瓩瓮瓲瓰瓱瓷甅甎甍甦甼畄畍畊畉偏畆貶畚畩平廢畤畧畫浦暴畭畸疆畴疊疉疂疔疚疝表疥疣疳痃疽疸疼疱痍痊品痒痣豊痞痾痿痼瘁痰痺痲痳瘋瘉瘧瘠瘡瘢癇癈癆癜皮癘癡必癢逼癨癩河學寒割癪咸合癧港海覈癬癰癲癶皀皃行皈向嘘皋憲歇皙驗皚皰皴盖盞盪蘯盻眇眄眤眛革懸血嫌協眷眸形惠睚睨睛乎惑混忽睥睿睾睹洪瞋化拡煥活瞑黄瞠瞶瞿瞼瞽會獲瞻矇矍矗橫孝矜矮砌砒後礦勳砠礪碎硴薨碆喧硼碚碌卉磆磋碾碼揮磅磬磧磚磽磴礇休礑礙恤礬礫凶祕釛欣祓祿屹禊欽吸禝興禧熙齋禳禺秕秬秡稍稘稙詰稟禀"


    Public hiragana = {&HA0, &HA2, &HA4, &HA6, &HA8, &HA9, &HAB, &HAD, &HAF, &HB1, &HB3, &HB5, &HB7, &HB9, &HBB, &HBD, &HBF, &HC2, &HC4, &HC6, &HC8, &HC9, &HCA, &HCB, &HCC, &HCD, &HD0, &HD3, &HD6, &HD9, &HDC, &HDD, &HDE, &HDF, &HE0, &HE2, &HE4, &HE6, &HE7, &HE8, &HE9, &HEA, &HEB, &HED}
    Public hiraso As Byte() = {&HA7, &HA8, &HA9, &HAA, &HAB, &HAF, &HAC, &HAD, &HAE, &HA6}
    Public jisso As Byte() = {&H9F, &HA1, &HA3, &HA5, &HA7, &HC1, &HE1, &HE3, &HE5, &HF0}

    Public msgfile As Byte()
    Public msgnum As UInteger
    Public msgnumstart As UInteger
    Public msgnumend As UInteger

    Public msgstart, postemp As ULong
    
    Public msgpos As UInteger()
    Public msgstr()() As Byte
    Public msglen As UInteger()
    Public jismsg As Byte()
    Public kormsg As Byte()
    Public filename As String
    Public searchindex As Integer = -1

    Dim jischr As String, korchr As String

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        Dim OpenFileDialog1 As New OpenFileDialog
        Dim myStream As Stream
        Dim buffer(3) As Byte
        Dim tempstr As String = ""

        OpenFileDialog1.InitialDirectory = "\msgW"
        OpenFileDialog1.Filter = "n14 files (*.n14)|*.n14"
        OpenFileDialog1.FilterIndex = 1
        openFileDialog1.RestoreDirectory = True

        If OpenFileDialog1.ShowDialog() = DialogResult.OK Then
            filename = OpenFileDialog1.SafeFileName
            myStream = OpenFileDialog1.OpenFile()
            If Not (myStream Is Nothing) Then

                ReDim msgfile(Convert.ToInt32(myStream.Length))

                myStream.Read(msgfile, 0, Convert.ToInt32(myStream.Length))
                myStream.Close()
            End If
        End If

        Me.Text = "NB14 MSG 편집기      "
        Me.Text &= filename

        If msgfile Is Nothing Then
            GoTo StandBy
        End If

        If (msgfile(&H0) = &H4E And msgfile(&H1) = &H31 And msgfile(&H2) = &H34 And msgfile(&H3) = &H46) = False Then

            MsgBox("파일을 열 수 없습니다. MSG 파일이 아닙니다.")
            GoTo StandBy

        End If

        msgnum = BitConverter.ToUInt32(msgfile, &H8)
        msgnumstart = BitConverter.ToUInt32(msgfile, &HC)
        msgnumend = BitConverter.ToUInt32(msgfile, &H10)

        For i = msgnumstart To msgnumend

            tempstr &= i.ToString

        Next

        msgstart = BitConverter.ToUInt32(msgfile, 4) + 16
        postemp = msgstart

        ReDim msgpos(msgnum)
        ReDim msgstr(msgnum - 1)
        ReDim msglen(msgnum - 1)

        ListBox2.Items.Clear()

        For i = 0 To msgnum - 1

            msglen(i) = BitConverter.ToUInt32(msgfile, postemp) - BitConverter.ToUInt32(msgfile, postemp - 4)
            ListBox2.Items.Add("msg" & msgnumstart + i)
            postemp += 4

        Next

        msgpos(0) = postemp

        For i = 1 To msgnum - 1

            msgpos(i) = postemp + msglen(i - 1)
            postemp += msglen(i - 1)

        Next

        msgpos(msgnum) = postemp + msglen(msgnum - 1)

        For i = 0 To msgnum - 1

            ReDim msgstr(i)(msglen(i) - 1)
            Array.ConstrainedCopy(msgfile, msgpos(i), msgstr(i), 0, msglen(i))

        Next

        ListBox2.SelectedIndex = 0

StandBy:

    End Sub

    Private Sub selection(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ListBox2.SelectedIndexChanged

        jisout(ListBox2.SelectedIndex)
        RichTextBox1.ClearUndo()

        korout(ListBox2.SelectedIndex)
        RichTextBox2.ClearUndo()

    End Sub

    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click

        Dim myStream As Stream
        Dim saveFileDialog1 As New SaveFileDialog()

        saveFileDialog1.Filter = "N14 files (*.N14)|*.N14"
        saveFileDialog1.FilterIndex = 1
        saveFileDialog1.RestoreDirectory = True
        saveFileDialog1.CheckFileExists = False
        saveFileDialog1.FileName = filename

        If saveFileDialog1.ShowDialog() = DialogResult.OK Then
            myStream = saveFileDialog1.OpenFile()
            If (myStream IsNot Nothing) Then

                myStream.Write(msgfile, 0, Convert.ToInt32(msgfile.Length))
                myStream.Close()
            End If
        End If

    End Sub

    Private Sub jisout(ByVal selectedid As Integer)

        ReDim jismsg(msglen(ListBox2.SelectedIndex) - 1)

        jismsg = msgstr(ListBox2.SelectedIndex)

        RichTextBox1.Clear()
        RichTextBox1.Multiline = True

        jischr = ""

        jischr = System.Text.Encoding.GetEncoding(932).GetString(jismsg)

        RichTextBox1.AppendText(jischr)

    End Sub

    Private Sub korout(ByVal selectedid As Integer)

        RichTextBox2.Clear()
        RichTextBox2.Multiline = True

        korchr = ""

        For i = 0 To jischr.Length - 1

            If Jisdic.Indexof(jischr(i)) >= 0 Then

                korchr &= kordic(Jisdic.indexof(jischr(i)))

            Else

                korchr &= jischr(i)

            End If

        Next

        RichTextBox2.AppendText(korchr)

    End Sub

    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click

        RichTextBox1.SelectAll()
        RichTextBox1.Copy()

    End Sub

    Private Sub Button4_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button4.Click

        RichTextBox2.Clear()
        RichTextBox2.AppendText(Clipboard.GetText())

    End Sub

    Private Sub Button5_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button5.Click

        Dim korstr As String
        Dim curindex As Integer = ListBox2.SelectedIndex
        Dim curlen As UInt32 = msgstr(curindex).Length
        Dim diff As Int32
        Dim curfilelen As UInt32 = msgfile.Length
        Dim strpos(3) As Byte
        Dim tempval As UInt32 = 0

        korstr = RichTextBox2.Text.ToString()
        jischr = ""

        For i = 0 To korstr.Length - 1

            If kordic.indexof(korstr(i)) >= 0 Then

                jischr &= Jisdic(kordic.indexof(korstr(i)))

            Else

                jischr &= korstr(i)

            End If

        Next

        Dim msgbyte() As Byte = System.Text.Encoding.GetEncoding(932).GetBytes(jischr)

        msglen(curindex) = msgbyte.Length
        diff = msgbyte.Length - curlen
        ReDim msgstr(curindex)(msgbyte.Length - 1)
        Array.ConstrainedCopy(msgbyte, 0, msgstr(curindex), 0, msgbyte.Length)

        ReDim Preserve msgfile(curfilelen + diff - 1)

        For i = curindex To msgnum - 1

            If i <> curindex Then

                msgpos(i) += diff
                tempval = msgpos(i) - msgstart - msgnum * 4
                strpos = BitConverter.GetBytes(tempval)
                Array.ConstrainedCopy(strpos, 0, msgfile, msgstart + (i - 1) * 4, 4)

            End If

            Array.ConstrainedCopy(msgstr(i), 0, msgfile, msgpos(i), msglen(i))

        Next

        tempval = msgpos(msgnum) - msgstart - msgnum * 4 + diff
        strpos = BitConverter.GetBytes(tempval)
        Array.ConstrainedCopy(strpos, 0, msgfile, msgstart + (msgnum - 1) * 4, 4)

        jisout(ListBox2.SelectedIndex)
        RichTextBox1.ClearUndo()

        korout(ListBox2.SelectedIndex)
        RichTextBox2.ClearUndo()

    End Sub

    Private Sub TextBox1_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles TextBox1.KeyPress

        Dim i As Integer
        Dim targetstr As String

        If Asc(e.KeyChar) = 13 Then

            For i = ListBox2.SelectedIndex To msgnum - 1

                targetstr = System.Text.Encoding.GetEncoding(932).GetString(msgstr(i))
                searchindex = targetstr.IndexOf(TextBox1.Text)

                If searchindex > -1 Then
                    ListBox2.SelectedIndex = i

                    RichTextBox2.SelectionStart = searchindex
                    RichTextBox2.SelectionLength = TextBox1.Text.Length
                    RichTextBox2.Select()

                    GoTo endsub

                End If

            Next

            MsgBox("일치하는 문장이 없습니다.")

        End If

endsub:

    End Sub

    Public Sub Form1_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles TextBox1.KeyPress

        If Asc(e.KeyChar) = Keys.F3 Then

            Button6.PerformClick()

        End If

    End Sub

    Private Sub Button6_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button6.Click

        Dim i As Integer
        Dim targetstr As String

        For i = (ListBox2.SelectedIndex + 1) To msgnum - 1

            targetstr = System.Text.Encoding.GetEncoding(932).GetString(msgstr(i))
            searchindex = targetstr.IndexOf(TextBox1.Text)

            If searchindex > -1 Then

                ListBox2.SelectedIndex = i

                RichTextBox2.SelectionStart = searchindex
                RichTextBox2.SelectionLength = TextBox1.Text.Length
                RichTextBox2.Select()

                GoTo endsub

            End If
        Next

        MsgBox("일치하는 문장이 없습니다.")

endsub:

    End Sub

End Class
